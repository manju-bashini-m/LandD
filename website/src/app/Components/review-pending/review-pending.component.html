<div class="container my-4" *ngIf="!showTraineeList">
  <!-- Title -->
  <div class="d-flex justify-content-between align-items-center mb-2" >
    <h2 class="h4 mb-0">Review - Pending</h2>
  </div>

  <!-- Search and Action Buttons -->
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-3">
    <!-- Search -->
    <div class="d-flex align-items-center bg-white rounded px-2" style="padding: 0.25rem;">
      <i class="ph ph-magnifying-glass text-muted fs-5 me-2"></i>
      <form [formGroup]="KeywordForm" class="mb-0">
        <input
          type="text"
          placeholder="Search by Keyword"
          class="form-control form-control-sm border-0 shadow-none"
          formControlName="filterByKeyword" />
      </form>
    </div>

    <!-- Action Buttons -->
    <div class="d-flex flex-wrap gap-2">
      <button
        type="button"
        *ngIf="reviewDetails.length < 10"
        class="btn">
        Employees: 0{{ reviewDetails.length }}
      </button>
      <button
        type="button" style="background-color: white; padding:8px;border:none;color:black"
        *ngIf="reviewDetails.length >= 10"
        class="btn btn-outline-secondary btn-sm">
        Employees: {{ reviewDetails.length }}
      </button>
      <button
      type="button"
      class="btn btn-outline-secondary btn-sm"
      (click)="downloadTable()"
      style="background-color: white; padding:8px;border:none;color:black">
        <i class="ph ph-download-simple"></i>
      </button>
      <button
        type="button" style="background-color: white; padding:8px ;border:none;color:black"
        class="btn btn-outline-secondary btn-sm"
        (click)="deleteAllMembers()">
        <i class="ph ph-trash"></i>
      </button>
      <button
        type="button"
        (click)="showFileUpload()"
        class="btn btn-sm d-flex align-items-center gap-1 text-white"
        style="background-color:#8347ad; border-color:#8347ad;">
        <i class="ph ph-paperclip"></i> Upload Files
      </button>
    </div>
  </div>

  <!-- Table -->

<div class="border table-responsive" style="max-height: 300px; overflow-y: auto;">
  <table class="table table-hover mb-0 align-middle">
    <thead class="table-light sticky-top">
      <tr style="height: 60px;">
        <th scope="col">
          <input type="checkbox" style="border: 1px solid grey;" id="parentCheckBox" class="form-check-input" (change)="clickAllCheckBoxes()" />
        </th>
        <th scope="col">Trainee ID <i class="ph ph-funnel-simple"></i></th>
        <th scope="col">Trainee Name <i class="ph ph-funnel-simple"></i></th>
        <th scope="col">Reviewer Name <i class="ph ph-funnel-simple"></i></th>
        <th scope="col">Technology <i class="ph ph-funnel-simple"></i></th>
        <th scope="col">TN Team <i class="ph ph-funnel-simple"></i></th>
        <th scope="col">Review Type <i class="ph ph-funnel-simple"></i></th>
        <th scope="col">Review Date <i class="ph ph-funnel-simple"></i></th>
        <th scope="col">Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngIf="reviewDetails.length === 0">
        <td colspan="9" class="text-center text-muted py-3">No Data Found</td>
      </tr>
      <tr *ngFor="let data of reviewDetails; let i = index" style="height: 60px;">
        <td>
          <input type="checkbox" style="border: 1px solid grey;" class="form-check-input" [id]="'checkbox' + i" />
        </td>
        <td (click)="showTraineeDetails(i)" style="cursor: pointer; color:#8347ad">{{ data.TRAINEE_ID }}</td>
        <td>{{ data.TRAINEE_NAME }}</td>
        <td>{{ data.REVIEWER_NAME }}</td>
        <td>{{ data.TECHNOLOGY }}</td>
        <td>{{ data.TN_TEAM }}</td>
        <td>{{ data.REVIEW_TYPE }}</td>
        <td>{{ data.REVIEW_DATE | date: 'dd-MM-yyyy' }}</td>
        <td>
          <button type="button" class="btn btn-link text-dark p-0" (click)="deleteMember(i)">
            <i class="ph ph-trash"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>


<!-- Trainee Details Section -->
<div class="container my-4" *ngIf="showTraineeList">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="h4 mb-0">Edit Score</h2>
    <button
      type="button"
      class="btn btn-outline-secondary d-flex align-items-center gap-1"
      (click)="showTraineeDetails(-1)">
      <i class="ph ph-rewind"></i> Back
    </button>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>Topic</th>
          <th>Objective</th>
          <th>Weightage</th>
          <th>Score</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="fw-bold">Technology</td>
          <td>{{ traineeDetail.TECHNOLOGY }}</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td class="fw-bold">Reviewer Name</td>
          <td>{{ traineeDetail.REVIEWER_NAME }}</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td class="fw-bold">Trainee Name</td>
          <td>{{ traineeDetail.TRAINEE_NAME }}</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td class="fw-bold">Mentor Name</td>
          <td>{{ traineeDetail.MENTOR_NAME }}</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td class="fw-bold">TN Team</td>
          <td>{{ traineeDetail.TN_TEAM }}</td>
          <td></td>
          <td></td>
        </tr>
        <tr *ngFor="let question of filteredQuestionBank; let ind = index">
          <td class="fw-bold">{{ question.TOPIC }}</td>
          <td>{{ question.OBJECTIVE }}</td>
          <td>{{ question.WEIGHTAGE }}</td>
          <td>
            <input
              type="number"
              class="form-control form-control-sm"
              min="0"
              [id]="'score' + ind"
              value="0" />
          </td>
        </tr>
        <tr>
          <td class="fw-bold">Overall Score</td>
          <td>{{ traineeDetail.OVERALL_SCORE }}</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td>
            <button
              type="button"
              class="btn btn-outline-secondary btn-sm"
              (click)="showTraineeDetails(-1)">
              Cancel
            </button>
          </td>
          <td></td>
          <td></td>
          <td>
            <button
              type="button"
              class="btn btn-sm text-white"
              style="background-color:#9C6FE4;"
              (click)="saveScore()">
              Submit
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Upload Modal -->
<div
  class="modal show fade d-block" 
  tabindex="-1" *ngIf="showUploadFile" style="background:rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Upload File</h5>
        <button
          type="button"
          class="btn-close"
          aria-label="Close"
          (click)="showFileUpload()">
        </button>
      </div>
      <form [formGroup]="uploadForm" (ngSubmit)="uploadFile()">
        <div class="modal-body">
          <input
            type="file"
            class="form-control"
            formControlName="fileUpload"
            (change)="onFileChange($event)" />
        </div>
        <div class="modal-footer">
          <button
            type="button" 
            class="btn btn-outline-secondary"
            (click)="clearForm()">
            <i class="ph ph-prohibit"></i> Cancel
          </button>
          <button
            type="submit"
            class="btn text-white"
            style="background-color:#9C6FE4;"
            [disabled]="!uploadForm.valid">
            Submit
          </button>
        </div>
      </form>
    </div>
  </div>
</div>