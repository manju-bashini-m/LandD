<div class="container my-3" *ngIf="!showTraineeList">
  <!-- Title -->
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h2 class="h4 mb-0">Review - Individual</h2>
  </div>

  <!-- Search and Buttons -->
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-2">
    <!-- Search -->
    <div class="d-flex align-items-center bg-white rounded px-2" style="padding: 0.25rem;">
     <i class="ph ph-magnifying-glass text-muted fs-5 me-2"></i>
     <form [formGroup]="KeywordForm" class="mb-0">
      <input
        type="text"
        placeholder="Search by Keyword"
        class="form-control form-control-sm border-0 shadow-none"
        formControlName="filterByKeyword" />
     </form>
    </div>

    <!-- Functional Buttons -->
    <div class="d-flex flex-wrap gap-2">
    <button
      type="button"
      *ngIf="TNData.length < 10"
      class="btn btn-outline-secondary btn-sm"
      style="padding: 0.3rem;">
      Employees: 0{{ TNData.length }}
    </button>
    <button
      type="button"
      *ngIf="TNData.length >= 10"
      class="btn btn-outline-secondary btn-sm"
      style="padding: 8px">
      Employees: {{ TNData.length }}
    </button>
    <button
      type="button"
      (click)="downloadTable()"
      class="btn btn-outline-secondary btn-sm"
      style="padding: 8px">
      <i class="ph ph-download-simple"></i>
    </button>
    <button
      type="button"
      (click)="deleteAllMembers()"
      class="btn btn-outline-secondary btn-sm"
      style="padding: 8px">
      <i class="ph ph-trash"></i>
    </button>
    <button
        type="button"
        (click)="showFileUpload()"
        class="btn btn-sm d-flex align-items-center gap-1 text-white"
        style="background-color: #8347ad; border-color: #8347ad;padding: 8px;">
        <i class="ph ph-paperclip"></i> Upload Files
    </button>
  </div>
  </div>
</div>

<div class="container my-3">
  <div
    class="table-responsive"
    style="max-height: 300px; overflow-y: auto;"
  >
    <table class="table table-hover mb-0">
      <thead style="font-size: 1vw;" class="table-light custom-header">
        <tr>
          <th scope="col">
            <input
              type="checkbox"
              class="form-check-input"
              style="border-color: grey;"
              id="parentCheckBox"
              (change)="clickAllCheckBoxes()"/>
          </th>
          <th scope="col">Trainee ID <i class="ph ph-funnel-simple"></i></th>
          <th scope="col">Trainee Name <i class="ph ph-funnel-simple"></i></th>
          <th scope="col">Reviewer Name <i class="ph ph-funnel-simple"></i></th>
          <th scope="col">Technology <i class="ph ph-funnel-simple"></i></th>
          <th scope="col">Review Type <i class="ph ph-funnel-simple"></i></th>
          <th scope="col">Review Date <i class="ph ph-funnel-simple"></i></th>
          <th scope="col">Action <i class="ph ph-funnel-simple"></i></th>
        </tr>
      </thead>
      <tbody style="font-size: 0.9vw;">
        <tr *ngIf="TNData.length === 0">
          <td colspan="8" class="text-center text-muted">
            No Data Found
          </td>
        </tr>
        <tr
          *ngFor="let data of TNData; let i = index"
          style="height: 60px;">
          <td>
            <input
              type="checkbox"
              style="border-color: grey;"
              class="form-check-input"
              [id]="'checkbox' + i"/>
          </td>
          <td
            (click)="showTraineeDetails(i, data)"
            style="cursor: pointer; color:#8347ad">
            {{ data.TRAINEE_ID }}
          </td>
          <td>{{ data.TRAINEE_NAME }}</td>
          <td>{{ data.REVIEWER_NAME }}</td>
          <td>{{ data.TECHNOLOGY }}</td>
          <td>{{ data.REVIEW_TYPE }}</td>
          <td>{{ data.REVIEW_DATE | date: 'dd-MM-yyyy' }}</td>
          <td>
            <div class="d-flex align-items-center gap-2">
              <button
                type="button"
                class="btn btn-link p-0 text-secondary"
                (click)="editMember(i)">
                <i class="ph ph-pencil-simple"></i>
              </button>
              <button
                type="button"
                class="btn btn-link p-0 text-dark"
                (click)="deleteMember(i)">
                <i class="ph ph-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="container my-4" *ngIf="showTraineeList">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="h4 mb-0">Review Report - Individual</h2>
    <button
      type="button"
      class="btn btn-outline-secondary d-flex align-items-center gap-1"
      (click)="showTraineeDetails(-1, '')">
      <i class="ph ph-rewind"></i> Back
    </button>
  </div>

  <!-- Table -->
  <div class="table-responsive">
    <table class="table table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th scope="col">Topic</th>
          <th scope="col">Objective</th>
          <th scope="col">Weightage</th>
          <th scope="col">Score</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="fw-bold text-secondary">Technology</td>
          <td>{{ traineeDetail.TECHNOLOGY }}</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td class="fw-bold text-secondary">Reviewer Name</td>
          <td>{{ traineeDetail.REVIEWER_NAME }}</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td class="fw-bold text-secondary">Trainee Name</td>
          <td>{{ traineeDetail.TRAINEE_NAME }}</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td class="fw-bold text-secondary">Mentor Name</td>
          <td>{{ traineeDetail.MENTOR_NAME }}</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td class="fw-bold text-secondary">TN Team</td>
          <td>{{ traineeDetail.TN_TEAM }}</td>
          <td></td>
          <td></td>
        </tr>
        <tr *ngFor="let question of filteredQuestionBank; let i = index">
          <td class="fw-bold">{{ question.TOPIC }}</td>
          <td>{{ question.OBJECTIVE }}</td>
          <td>{{ question.WEIGHTAGE }}</td>
          <td>{{ traineeDetail.MARKS_LIST[i] }}</td>
        </tr>
        <tr>
          <td class="fw-bold text-secondary">Overall Score</td>
          <td>{{ traineeDetail.OVERALL_SCORE }}</td>
          <td></td>
          <td></td>
        </tr>
        <tr>
          <td class="fw-bold text-secondary">Overall Performance</td>
          <td>{{ traineeDetail.OVERALL_PERFORMANCE }}</td>
          <td></td>
          <td></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div
  class="modal show fade d-block"
  tabindex="-1"
  role="dialog"
  *ngIf="showUploadFile">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <!-- Header -->
      <div class="modal-header">
        <h5 class="modal-title">Upload File</h5>
        <button
          type="button"
          class="btn-close"
          aria-label="Close"
          (click)="showFileUpload()"></button>
      </div>

      <!-- Body -->
      <form [formGroup]="uploadForm" (ngSubmit)="uploadFile()">
        <div class="modal-body">
          <div class="mb-3">
            <label for="fileUpload" class="form-label">Select Excel File</label>
            <input
              type="file"
              id="fileUpload"
              class="form-control"
              formControlName="fileUpload"
              (change)="onFileChange($event)" />
          </div>
        </div>

        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-outline-secondary me-2"
            (click)="clearForm()">
            <i class="ph ph-prohibit"></i> Cancel
          </button>
          <button
            type="submit"
            class="btn text-white"
            style="background-color:#8347ad;"
            [disabled]="!uploadForm.valid">
            Submit
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Edit Member Modal -->
<div
  class="modal fade show d-block"
  tabindex="-1"
  role="dialog"
  *ngIf="showEditMember"
  style="background-color: rgba(0, 0, 0, 0.5);">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title">Edit Member</h5>
        <button
          type="button"
          class="btn-close"
          aria-label="Close"
          (click)="showEdit()"></button>
      </div>

      <!-- Modal Body -->
      <form [formGroup]="editMemberForm" (ngSubmit)="EditedMemberDetails(editMemberForm.value)">
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <input type="text" class="form-control" placeholder="ACE ID" formControlName="ACE_ID" />
            </div>
            <div class="col-md-6">
              <input type="text" class="form-control" placeholder="First Name" formControlName="First_Name" />
            </div>
            <div class="col-md-6">
              <input type="text" class="form-control" placeholder="Last Name" formControlName="Last_Name" />
            </div>
            <div class="col-md-6">
              <input type="text" class="form-control" placeholder="Designation" formControlName="Designation" />
            </div>
            <div class="col-md-6">
              <input type="text" class="form-control" placeholder="Team" formControlName="Team" />
            </div>
            <div class="col-md-6">
              <input type="text" class="form-control" placeholder="Practice" formControlName="Practice" />
            </div>
          </div>
        </div>

        <!-- Modal Footer -->
        <div class="modal-footer">
          <button type="button" style="border:1px solid purple;" class="btn btn-outline-secondary btn-sm btn-hover-purple" (click)="clearForm(); showEdit();">
            <i class="ph ph-prohibit"></i> Cancel
          </button>
          <button type="submit" class="btn text-white" style="background-color: #8347ad;" [disabled]="editMemberForm.valid">
            Submit
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
